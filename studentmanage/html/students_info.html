<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Information</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .search-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .student-table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .student-table th {
            background: #343a40;
            color: white;
            font-weight: 600;
            padding: 12px;
            border: none;
        }
        .student-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }
        .student-table tr:hover {
            background-color: #f8f9fa;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .no-results {
            display: none;
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        .grade-badge {
            font-size: 0.85em;
            padding: 4px 8px;
        }
        .btn-sm {
            padding: 4px 8px;
            font-size: 0.875rem;
        }
        .loading-container {
            text-align: center;
            padding: 40px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1 class="text-center mb-4">Student Information</h1>
        
        <div class="search-container">
            <div class="row">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control" id="searchInput" placeholder="Search by name, phone, stream..." autocomplete="off">
                    </div>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="gradeFilter">
                        <option value="all">All Grades</option>
                        <option value="11">11th Grade</option>
                        <option value="12">12th Grade</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="streamFilter">
                        <option value="all">All Streams</option>
                        <option value="PCM">PCM</option>
                        <option value="PCB">PCB</option>
                        <option value="PCMB">PCMB</option>
                        <option value="Commerce">Commerce</option>
                        <option value="Arts">Arts</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div id="loadingSpinner" class="loading-container">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading students data...</p>
        </div>
        
        <div id="noStudents" class="no-results">
            <i class="bi bi-people-fill" style="font-size: 3rem;"></i>
            <h3 class="mt-3">No students found</h3>
            <p class="text-muted">Try adjusting your search or filters</p>
        </div>
        
        <div class="table-responsive">
            <table class="student-table table table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Contact</th>
                        <th>Grade</th>
                        <th>Stream</th>
                        <th>Address</th>
                        <th>Parent Info</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="studentsTableBody">
                    <!-- Students will be loaded from Firebase -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Confirm Delete</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this student's record?</p>
                    <p class="fw-bold" id="studentToDeleteName"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase and Bootstrap JS -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentStudentToDelete = null;

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            filterStudents();
        });

        // Filter functionality
        document.getElementById('gradeFilter').addEventListener('change', function() {
            filterStudents();
        });

        document.getElementById('streamFilter').addEventListener('change', function() {
            filterStudents();
        });

        // Filter students based on search and filters
        function filterStudents() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const gradeFilter = document.getElementById('gradeFilter').value;
            const streamFilter = document.getElementById('streamFilter').value;
            
            const rows = document.querySelectorAll('#studentsTableBody tr');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                const contact = row.cells[1].textContent.toLowerCase();
                const grade = row.cells[2].textContent;
                const stream = row.cells[3].textContent;
                
                const matchesSearch = name.includes(searchTerm) || contact.includes(searchTerm) || 
                                    stream.toLowerCase().includes(searchTerm);
                const matchesGrade = gradeFilter === 'all' || grade.includes(gradeFilter);
                const matchesStream = streamFilter === 'all' || stream.includes(streamFilter);
                
                if (matchesSearch && matchesGrade && matchesStream) {
                    row.style.display = '';
                    visibleCount++;
                    
                    // Highlight search terms
                    if (searchTerm) {
                        highlightText(row, searchTerm);
                    } else {
                        removeHighlight(row);
                    }
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Show/hide no results message
            const noResultsDiv = document.getElementById('noStudents');
            if (visibleCount === 0) {
                noResultsDiv.style.display = 'block';
            } else {
                noResultsDiv.style.display = 'none';
            }
        }

        // Highlight search terms
        function highlightText(row, searchTerm) {
            const cells = row.querySelectorAll('td');
            cells.forEach(cell => {
                if (cell.cellIndex < 4) { // Only highlight in first 4 columns
                    const text = cell.textContent;
                    const regex = new RegExp(`(${searchTerm})`, 'gi');
                    cell.innerHTML = cell.innerHTML.replace(regex, '<span class="highlight">$1</span>');
                }
            });
        }

        // Remove highlight
        function removeHighlight(row) {
            const highlights = row.querySelectorAll('.highlight');
            highlights.forEach(highlight => {
                highlight.outerHTML = highlight.innerHTML;
            });
        }

        // Edit student function
        function editStudent(studentId) {
            // Your Firebase edit logic here
            console.log(`Edit student with ID: ${studentId}`);
        }

        // Delete student function
        function deleteStudent(studentId, studentName) {
            currentStudentToDelete = studentId;
            document.getElementById('studentToDeleteName').textContent = studentName;
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
            deleteModal.show();
        }

        // Confirm delete
        document.getElementById('confirmDelete').addEventListener('click', function() {
            if (currentStudentToDelete) {
                // Your Firebase delete logic here
                console.log(`Delete student with ID: ${currentStudentToDelete}`);
                
                // Close modal
                const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
                deleteModal.hide();
                
                // Reset current student
                currentStudentToDelete = null;
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Your Firebase initialization and data loading logic here
            // Hide loading spinner after data is loaded
            // document.getElementById('loadingSpinner').style.display = 'none';
        });
    </script>
    <script src="/js/students_info.js"></script>
</body>
</html>